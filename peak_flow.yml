before_install:
  - node scripts/setup-android-emulator.js
before_script:
  - npm install
  - cd spec/dummy && npm install
builds:
  build_1:
    name: Default checks
    script:
      - npm run all-checks
  build_2:
    name: Appium Android
    environment:
      ANDROID_SDK_ROOT: /usr/lib/android-sdk
      SYSTEM_TEST_HOST: dist
      SYSTEM_TEST_DRIVER: appium
      SYSTEM_TEST_APPIUM_DRIVERS: uiautomator2
      SYSTEM_TEST_APPIUM_TEST_ID_STRATEGY: css
      SYSTEM_TEST_APPIUM_SERVER_ARGS: '{"allowInsecure":["uiautomator2:chromedriver_autodownload"]}'
      SYSTEM_TEST_APPIUM_CAPABILITIES: '{"platformName":"Android","appium:automationName":"UiAutomator2","appium:deviceName":"Android Emulator","browserName":"Chrome","appium:chromedriverAutodownload":true}'
    script:
      - npm run export:web
      - npx appium driver update uiautomator2 || npx appium driver install uiautomator2
      - npm test
