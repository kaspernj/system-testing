# Changelog

## Unreleased
- Prevent system test shutdown timeouts by forcing HTTP server connections closed and shutting down the browser before the HTTP server.
- Convert patch release script to Node and add `release:patch` npm script.
- Run release patch commands with direct TTY handling for npm 2FA prompts.
- Bump `flash-notifications` to 0.0.38 in lockfiles.
- Switch `useEventEmitter` import to `ya-use-event-emitter`.
- Remove `@kaspernj/api-maker` peer dependency.
- Remove `@kaspernj/api-maker` from the dummy app dependencies.
- Add `qs` to the dummy app dependencies for system-testing hooks.
- Run release patch commands with direct TTY handling for npm 2FA prompts.
- Document allowed args for system test selector helpers with shared JSDoc typedefs.
- Move JSDoc typedefs to follow imports per agent guidance.
- Mark optional args in JSDoc where needed.
- Allow dismissing notification messages after assertion with a `dismiss` arg.
- Wait for the matching flash notification to disappear when dismissed.
- Use notification `data-count` to track dismissals for `expectNotificationMessage`.
- Read notification message text from `textContent` when available for DOM consistency.
- Read notification message text via DOM `textContent` script lookup.
- Make notification system test elements clickable for dismissal behavior.
- Pin notification test container to the viewport for reliable clicks.
- Only poll visible notification messages in `expectNotificationMessage`.
- Document `FindArgs.visible` as a boolean-only option.
- Include error type details in system test selector errors.
- Require the root system testing component to be visible before proceeding.
- Bump `ya-use-event-emitter` to 0.1.2.
- Retry `SystemTest.all` waits using remaining timeout and filter for visibility during lookups.
- Add a system test covering `SystemTest.all` retries and visibility filtering.
- Allow `SystemTest.click` to pass finder args like `useBaseSelector`.
- Allow `SystemTest.interact` to accept selector objects with finder args.
- Add system test coverage for `SystemTest.interact` selector objects.
- Document finder options for selector helpers in the README.
- Treat stale element reference errors as retryable in `waitForNoSelector`.
- Push version bump commits to `master` in the patch release script.
- Disable implicit waits during `waitForNoSelector` polling.
- Add a system test to ensure `waitForNoSelector` returns quickly when nothing matches.
- Add a timeout around system test initialization to surface stalled communicator setup.
- Add `onFirstInitialize` for one-time setup when system testing initializes.
- Add HTTP server health checks on system test startup and surface post-start server errors.
- Use a separate connect host for HTTP server health checks when binding to 0.0.0.0.
- Retry HTTP server health checks on transient connection errors.
- Always print system test debug errors instead of hiding them behind debug mode.
- Wait for the browser Scoundrel client to initialize before resolving `getScoundrelClient`.
- Extract Selenium behavior into drivers and add Appium driver support with configurable sub-drivers.
- Add a Peakflow Appium Android build to run system tests against the dummy app.
- Add npm scripts for Selenium and Appium Android system test runs.
- Add Appium Android test script preflight for Android SDK env vars.
- Ensure Appium server shutdown runs even when WebDriver teardown fails.
- Allow the Appium Android test script to infer the Android SDK path.
- Add Android emulator setup steps to Peakflow for Appium runs.
- Locate Android SDK tools dynamically in Peakflow setup.
- Add a Node script to configure and boot the Android emulator for Peakflow.
- Install Android SDK packages via apt when the SDK is missing in Peakflow.
- Download Android cmdline-tools when they are missing in Peakflow.
- Add 5s timeouts around screenshot, log, and HTML capture in system tests.
- Forward /dev/kvm into Peakflow builds for Android emulator support.
- Move KVM device mapping into the Appium build config.
- Fall back to sudo for emulator/adb when KVM access requires root in containers.
- Run emulator and adb with sudo in container environments.
- Share ANDROID_AVD_HOME across sudo/non-sudo runs to avoid missing AVDs.
- Create AVDs with sudo and permissive AVD home permissions in CI containers.
- Poll for emulator boot completion with a timeout in the setup script.
- Allow specifying an HTTP connect host for emulator access in Appium runs.
- Start the adb server as the build user so Appium can see emulator devices.
- Split emulator setup into install and start stages for CI.
- Keep HTTP server health checks on the host even when the driver connects via a different host.
